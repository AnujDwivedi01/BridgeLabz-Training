CREATE TABLE vm_patients (
    patient_id INT AUTO_INCREMENT PRIMARY KEY,
    patient_name VARCHAR(50)
);


INSERT INTO vm_patients (patient_name) VALUES
('Amit Verma'),
('Riya Sharma');

CREATE TABLE vm_doctors (
    doctor_id INT AUTO_INCREMENT PRIMARY KEY,
    doctor_name VARCHAR(50)
);

INSERT INTO vm_doctors (doctor_name) VALUES
('Dr. Anil Kumar'),
('Dr. Sunita Jain');

CREATE TABLE vm_appointments (
    appointment_id INT AUTO_INCREMENT PRIMARY KEY,
    patient_id INT,
    doctor_id INT,
    appointment_date DATE,
    status VARCHAR(20)
);

INSERT INTO vm_appointments
(patient_id, doctor_id, appointment_date, status)
VALUES
(1, 1, '2026-03-10', 'SCHEDULED');

CREATE TABLE vm_visits (
    visit_id INT AUTO_INCREMENT PRIMARY KEY,
    appointment_id INT,
    patient_id INT,
    doctor_id INT,
    visit_date DATE,
    diagnosis VARCHAR(100),
    notes VARCHAR(200)
);

CREATE TABLE vm_prescriptions (
    prescription_id INT AUTO_INCREMENT PRIMARY KEY,
    visit_id INT,
    medicine_name VARCHAR(50),
    dosage VARCHAR(30),
    duration VARCHAR(30)
);

START TRANSACTION;

INSERT INTO vm_visits
(appointment_id, patient_id, doctor_id, visit_date, diagnosis, notes)
VALUES
(1, 1, 1, '2026-03-10', 'Viral Fever', 'Patient advised rest');

UPDATE vm_appointments
SET status = 'COMPLETED'
WHERE appointment_id = 1;

COMMIT;

SELECT
    v.visit_date,
    d.doctor_name,
    v.diagnosis,
    p.medicine_name,
    p.dosage,
    p.duration
FROM vm_visits v
JOIN vm_prescriptions p ON v.visit_id = p.visit_id
JOIN vm_appointments a ON v.appointment_id = a.appointment_id
JOIN vm_doctors d ON v.doctor_id = d.doctor_id
WHERE v.patient_id = 1
ORDER BY v.visit_date DESC;

INSERT INTO vm_prescriptions
(visit_id, medicine_name, dosage, duration)
VALUES
(1, 'Paracetamol', '500mg', '5 days'),
(1, 'Vitamin C', '1 tablet', '7 days'),
(1, 'Cough Syrup', '10ml', '5 days');

